---
title: "3 Myths of CO2 Emissions"
date: "JAN 15th,2020"
output: 
  html_document: 
  code_folding: hide
---

## Introduction
For this visual explorative analysis using R we used a data set sourced from Organisation for Economic Co-operation and Development (OECD) that includes countries, year of recording, percentage electricity generated by fossil fuel, total emission of co2 and ton per capita of co2.
We have selected this data to see if the following statements are true or false:

*1.Developing countries emit more CO2 under rapid economic development.*  
  *2.More CO2 emission, more death affected by air pollution.*  
*3.Emerging economy countries are reducing their reliance on fossil fuels over time as they become more developed.*

Below we will show that these facts are actually myths backed by visual analysis from the generated plots. Additionally in section 4 of the report we have included plots for further consideration that might prove useful for additional analysis.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Data Sources:**
  OECD (2020), Air and GHG emissions (indicator) (Accessed on 16 January 2020);   
  IEA Statistics Â© OECD/IEA 2014   
     
        


```{r library,include=FALSE}
#Loading the libaries
library(ggplot2)
library(ggthemes)
library(nlme)
library(gganimate)
library(gapminder)
library(ggExtra)
library(psych)
library(reshape2)
library(dplyr)
library(nycflights13)
library(ggcorrplot)
library(waffle)
library(tidyr)
library(scales)
library(ggalt)
library(data.table)
library(extrafont)
library(lubridate)
library(DT)
library(grid)
library(gridExtra)
library(prettydoc)
library(devtools)
library(tidyverse)
library(ggdark)
library(here)
library(png)
library(gifski)
library(forcats)
library(tufte)
library(colorspace)
library(viridisLite)
library(Zelig)
library(formatR)
library(DiagrammeR)
library(xaringan)
library(ggridges)
library(GGally)
library(forcats)
library(gghighlight)
library(tidyverse)


```

```{r source, echo=FALSE, include=FALSE,message=F}
folder_path<-"/Users/MenaL/Desktop/assignment_1"
wlde<-fread(file.path(folder_path,"wlde.csv"), sep=",", header=T)

```

## Visualization
```{r theme, echo=FALSE, include=FALSE,message=FALSE}
knitr::opts_chunk$set(echo = FALSE)
#Defining the general colors  

fill_color='#140B07'
fill_color2 = '#351D11'
decoration_color = '#DAFDD6'
main1_color = '#E8EDDF'
main2_color = '#CFDBD5'
font = '#808080'
high="#306B34"
uppmid="#1C5253"
lowmid="#7A934B"
low="#CC483A"

#Create a personalised theme
airtheme<-theme_bw() + theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
  plot.title = element_text(size = 14, hjust = 0.2, color = font),
  axis.title = element_text(size = 10, hjust = 0.5, color = font),
  axis.text = element_text(colour = font, size = 6),
  axis.ticks = element_blank(),
  axis.line = element_line(colour = font, size=0.3, linetype = "dashed"), 
  panel.border = element_blank(),
  panel.grid = element_blank(),
  strip.text = element_text(size = 12, color = decoration_color),
  panel.background =element_rect(fill = fill_color),
  strip.background =element_rect(fill = fill_color), 
  plot.background = element_rect(fill = fill_color),
  legend.text	= element_text(size = 10, hjust = 0.5, color = font), 
  legend.position = c(0.815, 0.27),
  legend.key = element_blank(),
  legend.title = element_blank()
)

#Now we set the new defined theme to the default option 
theme_set(airtheme)

#No axis title
theme_set(dark_theme_gray()+ theme(
  panel.grid.major = element_blank(), 
  panel.grid.minor = element_blank(),
  axis.title = element_blank(),
  axis.text = element_text(colour = font, size = 9),
  axis.ticks = element_blank(),
  legend.title = element_blank(),
  panel.background =element_rect(fill = fill_color),
  strip.background =element_rect(fill = fill_color), 
  plot.background = element_rect(fill = fill_color),
  legend.background = element_rect(fill = fill_color)
))

```
   
   
**1.1 Total CO2 Emissions from 1990 to 2015 in millions of tonnes**
```{r echo=FALSE,fig.align="center",warning=F}
basic <-ggplot(wlde, aes(year, total_em, group=country)) 

ggplot(wlde, aes(year, total_em, group=country)) +
  geom_line(lwd = 0.1, show.legend = FALSE) +
   theme(axis.text.x=element_blank())+
  gghighlight(max(total_em) > 750, label_key = country,unhighlighted_colour = "#59463C")
```
   
   
*1.1.1High Income & Upper Middle Income Countries*
```{r  echo=FALSE,fig.align= "center",warning=F}
ggplot(wlde, aes(year, total_em, group=country)) +
  facet_wrap(~income,ncol=4)+
  geom_line(lwd = 0.1, show.legend = FALSE) +
  gghighlight(max(total_em) > 750, label_key = country,unhighlighted_colour="#59463C") 
```
   
   
**1.2 Show countries with total CO2 emissions below 70 million tonnes and hightlight the countries with the greatest change over the last 25 years.**
```{r echo=FALSE,fig.align= "center",warning=F,fig.width=10}
wlde%>%
  mutate(income = fct_relevel(income, 
                              "HIGH", "UPPMID", "LOWMID", 
                              "LOW"))%>%
  ggplot(aes(year, total_em, group=country)) + ylim(0,700)+
  geom_line(lwd = 0.045, show.legend = FALSE) +
  facet_wrap(~income,ncol=4)+
  theme(axis.text.x=element_blank())+
  gghighlight((max(total_em)-min(total_em)) > 300, label_key = country, unhighlighted_colour="#59463C") 

```
   
      
        
 
### 2. MYTH ONE:  More CO2 is emitted as countries undergo rapid economic development.
**WRONG: **Lower income countries (less developed countries) have lower ton per capita CO2 emissions over the past 25 years.

**2.1 Countries with CO2 emissions per capita higher than 20 tonnes**
```{r echo=FALSE,fig.align= "center",warning=F}
wlde%>%
  mutate(income = fct_relevel(income, 
                              "HIGH", "UPPMID", "LOWMID", 
                              "LOW"))%>%
  ggplot(aes(year, tonpcap, group=country)) +
  geom_line(lwd = 0.1, show.legend = FALSE)+
  facet_wrap(~income,ncol=4)+
  theme(axis.text.x=element_blank())+
  gghighlight(max(tonpcap) > 20, label_key = country, unhighlighted_colour="#59463C") 
```
         
    
*2.1.1 All countries with CO2 emissions per capita higher than 20 tonnes are from the high income group, grouped by region *
```{r echo=FALSE,fig.align= "center",warning=F,fig.width=10}
 ggplot(wlde,aes(year, tonpcap, group=country)) +
  geom_line(lwd = 0.1, show.legend = FALSE)+
  facet_wrap(~region,ncol=4)+
   theme(axis.text.x=element_blank())+
  gghighlight(max(tonpcap) > 20, label_key = country, unhighlighted_colour="#59463C") 
```
         
    
**2.2 Density: CO2 emissions in tonnes per capita**
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
wlde%>%
  mutate(income = fct_relevel(income, 
                              "LOW", "LOWMID", "UPPMID", 
                              "HIGH"))%>%
  ggplot(aes(x = tonpcap, y = income,fill=income)) +
  geom_density_ridges(fill=decoration_color,color=fill_color,scale=4,size=0.4,alpha=0.5)
```
           
     
**2.3 In 2015, developed nations had higher CO2 emissions per capita.**
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
wlde%>%
  mutate(income = fct_relevel(income, 
                              "LOW", "LOWMID", "UPPMID", 
                              "HIGH"))%>%
  subset(year==2015)%>%
  ggplot(aes(x=tonpcap,y=income))+
   theme(axis.text.x=element_blank())+
  geom_density_ridges(panel_scaling=T,color=fill_color, scale=1.5,size=0.5,alpha=0.5,fill=decoration_color)
```
  
   
*2.3.1 Group by Region (density)*
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
wlde%>%
  mutate(region = fct_relevel(region, 
                              "Europe & Central Asia",
                              "Middle East & North Africa",
                              "East Asia & Pacific", 
                              "Sub-Saharan Africa",
                              "Latin America & Caribbean",
                              "North America",
                              "South Asia"
                             ))%>%
  ggplot(aes(x = tonpcap, y = region)) +
   theme(axis.text.x=element_blank())+
  geom_density_ridges(fill=decoration_color,color=fill_color,scale=6,size=0.4,alpha=0.78)
```
   
    
### 3.MYTH 3: MORE CO2 emissions lead to more deaths caused by air pollution. 
**WRONG: The higher the CO2 emissions, the higher the Value of a Statistical Life over 10 tonnes per capita, while the pattern is opposite below 10, especially in high income countries.**
   
**More emission of CO2 does not necessarily increase the level of pm2.5 pollutant that causes death.**

**3.1 Overall trend of mortality & CO2 emissions per capita**
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
require(gridExtra)

###overall trend
ggplot(wlde, aes(y=tonpcap, x=mortality,color=income)) +
  geom_point(size=.3,alpha=0.7,pch=16)+
  geom_smooth(aes(group = 1), colour = font, size = 0.2, method = "lm", se = TRUE)+
  scale_x_log10(breaks = round(as.vector(quantile(wlde$mortality)), digits = 0))+
  theme(legend.position="none")+
  scale_color_manual(values=c(decoration_color,"#59463C","#59463C","#59463C"))
```
   
      
*3.1.1 Highlighted by high income countries*
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
top10<-ggplot(wlde, aes(y=tonpcap, x=mortality,color=income)) +
  geom_point(size=.3,alpha=0.7,pch=16)+
  geom_smooth(aes(group = 1), colour = font, size = 0.2, method = "lm", se = TRUE)+
  scale_x_log10(breaks = round(as.vector(quantile(wlde$mortality)), digits = 0))+
  theme(legend.position="none")+
  theme(axis.title.x=element_blank(),axis.text.x=element_blank())+
  ylim(10,NA)+
  scale_color_manual(values=c(decoration_color,"#59463C","#59463C","#59463C"))

bot10<-ggplot(wlde, aes(y=tonpcap, x=mortality,color=income)) +
  geom_point(size=.3,alpha=0.7,pch=16)+
  geom_smooth(aes(group = 1), colour = font, size = 0.2, method = "lm", se = TRUE)+
  scale_x_log10(breaks = round(as.vector(quantile(wlde$mortality)), digits = 0))+
  theme(legend.position="none")+
  ylim(NA,10)+
  scale_color_manual(values=c(decoration_color,"#59463C","#59463C","#59463C"))

grid.arrange(top10, bot10, nrow=2)
```
  
   
*3.1.2 Other two graphs: Hexagonal Heatmap.*
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
ggplot(wlde, aes(y=tonpcap, x=mortality)) +
  scale_x_log10(breaks = round(as.vector(quantile(wlde$mortality)), digits = 1))+
  geom_hex( alpha = 0.4)+
  scale_fill_gradient(low="#6C5A51", high=decoration_color)
```
  
   
   
*3.1.3 Other two graphs: Connected scatter-plot highlighted in years.*
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
wlde %>% arrange(income, year) %>%
  ggplot(aes( y = tonpcap, x = mortality, colour = income)) +
  geom_text(check_overlap = TRUE, aes(label = year),alpha=.8,size=2) +
  geom_point(alpha=.1,size=0.5) +
  geom_path(alpha=.15,size=0.1) +
  theme(legend.position="none")+
  scale_color_manual(values=c(high, uppmid,lowmid,low))+ylim(0,30)
```


### 4. MYTH THREE: Under the new Paris Agreement, developing countries are striving to reduce electricity produced by fossil fuels
**WRONG: **High income countries are finding ways to reduce energy production by fossil fuel  


**4.1 The electricity production pattern highlighted by some countries with high total CO2 emission electricity production pattern, grouped by income**  
```{r echo=FALSE,fig.align= "center",warning=F,message=F,fig.width=12}
wlde%>%
  mutate(income = fct_relevel(income, 
                              "HIGH", "UPPMID", "LOWMID", 
                              "LOW"))%>%
  ggplot()+
  geom_line(aes(year, elect_p, group = country),size=0.1,alpha=0.3)+
  gghighlight(mean(total_em) > 300, label_key = country, unhighlighted_colour="#59463C", label.size=2)+
  facet_wrap(~income,ncol=4)+
  theme(axis.text.x=element_blank())+
  geom_smooth(data=wlde, aes(year, elect_p, group = 1), lwd = 0.5, method = 'lm', span = 2, se = TRUE, color = decoration_color)
```


**4.2 The electricity production pattern highlighted by some countries with high total CO2 emission electricity production pattern, grouped by regions**  
```{r echo=FALSE,fig.align= "center",warning=F,message=F,fig.width=13}
wlde%>%
  mutate(region = fct_relevel(region, 
                              "Europe & Central Asia",
                              "North America",
                              "Middle East & North Africa",
                              "East Asia & Pacific", 
                              "Sub-Saharan Africa",
                              "Latin America & Caribbean",
                              "South Asia"
  ))%>%
  ggplot()+
  geom_line(aes(year, elect_p, group = country),size=0.1,alpha=0.3)+
  gghighlight(mean(total_em) > 300, label_key = country, unhighlighted_colour="#59463C", label.size=0.5)+
  facet_wrap(~region,ncol=7)+
  theme(axis.text.x=element_blank())+
  geom_smooth(data=wlde, aes(year, elect_p, group = 1), lwd = 0.5, method = 'lm', span = 2, se = TRUE, color = decoration_color)
```

#### But, low income countries have relatively lower percentage of electricity generated by oil, natural gas and coal.

*4.3 Density of electricity production, group by income groups*  
```{r echo=FALSE,fig.align= "center",warning=F,message=F}
wlde%>%
  mutate(income = fct_relevel(income, 
                              "HIGH", "UPPMID", "LOWMID", 
                              "LOW"))%>%
ggplot( aes(elect_p, group=income, fill=income)) +
  geom_density(adjust=1.5, color= NA,alpha=0.5) + 
  scale_fill_manual(values=c(high, uppmid,lowmid,low))
```


**4.4 Four lower income countries (Haiti,Tanzania,Honduras,Sri Lanka) have reduced more than 50% of its electricity production by fossil fuel from 1990, but among the countries that have increase, the high income country Denmark takes the lead.**   
  
```{r echo=FALSE,fig.align= "center", warning=F, message=F,fig.height=6}
#DUMBBELL PLOT

#SIMPLE dumbbell plot

#Creating a subsample 
wlde_sv2 <- filter(wlde, year %in% c(1990, 2015)) %>% select(country, income, year, elect_p);


#Convert data to wide format
wlde_svf2 <- spread(wlde_sv2, year, elect_p)
names(wlde_svf2) <- c("country", "income", "y1990", "y2015")

#SORTED dumbbell plot 

#Sorted by 1990
wlde_svf3 <- arrange(wlde_svf2, desc(y1990))
wlde_svf3$country <- factor(wlde_svf3$country, levels=rev(wlde_svf3$country))


#create dif variable
wlde_svf3$y1990<-as.double(wlde_svf3$y1990)
wlde_svf3$y2015<-as.double(wlde_svf3$y2015)
wlde_svf3$dif<-wlde_svf3$y1990-wlde_svf3$y2015
wlde_svf3 <- arrange(wlde_svf3, desc(dif))
#order by dif
wlde_svf3 <- arrange(wlde_svf3, desc(dif))
wlde_svf3$country <- factor(wlde_svf3$country, levels=rev(wlde_svf3$country))

#COLOURED dumbbell plot        

#Sorted by 1990
wlde_svf4 <- arrange(wlde_svf3, desc(y1990))
wlde_svf4$country <- factor(wlde_svf4$country, levels=rev(wlde_svf4$country))

#Sorted by 2015
wlde_svf5 <- arrange(wlde_svf3, desc(y2015))
wlde_svf5$country <- factor(wlde_svf5$country, levels=rev(wlde_svf5$country))

#Create dumbbell plot now sorted 
ggplot(wlde_svf5, aes(country, x = y1990, xend = y2015)) +
  geom_dumbbell(colour=decoration_color,colour_xend="font",colour_x=font,alpha=0.5)   +
  theme(axis.text = element_text( size = 3))+
  gghighlight(abs(dif)>50, label_key = country, unhighlighted_colour="#59463C") 


```

### 5. Advanced Try
**For both total emission and emission per capita, both high and upper middle income countries stand out with greater variances.**
```{r echo=FALSE,fig.align= "center",warning=F,message=F}

wlde%>%
  mutate(income = fct_relevel(income, 
                              "HIGH", "UPPMID", "LOWMID", 
                              "LOW"))%>%
  ggparcoord(columns = 5:8, groupColumn=3,alphaLines = 0.22,scale="center")+
  scale_colour_manual(values=c(high, uppmid,lowmid,low))

```

